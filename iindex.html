<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="icon" href="./favicon.svg" type="image/svg+xml">
  <meta charset="UTF-8" />
  <title>힐스테이트 메디알레 입주예정자협의회 위임장</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet" />
  
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="header-logo">H</div>
      <h1>힐스테이트 메디알레 입주예정자협의회 위임장</h1>
    </div>

    <div class="layout">
      <aside class="sidebar">
        <div class="sidebar-section">
          <div class="sidebar-section-title">수신</div>
          <ul>
            <li>힐스테이트 메디알레</li>
            <li>입주예정자협의회</li>
          </ul>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">계약자 정보</div>
          <ul>
            <li>계약자 성명</li>
            <li>생년월일(앞 6자리)</li>
            <li>휴대전화 / 이메일</li>
            <li>계약 동·호수</li>
            <li>입주자 카페 ID</li>
          </ul>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">공동명의</div>
          <ul>
            <li>공동명의 계약자</li>
            <li>있을 경우만</li>
            <li>성명 입력</li>
          </ul>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-section-title">제출 안내</div>
          <ul>
            <li>필수항목 입력</li>
            <li>전자서명 후</li>
            <li>제출 버튼 클릭</li>
          </ul>
        </div>
      </aside>

      <main class="content">
        <form id="delegation-form" action="https://formsubmit.co/670b886c601a1283a1e4132512eef245" method="POST">
          <input type="hidden" name="_next" value="https://mediale483.github.io/thanks.html" />
          <input type="hidden" name="_subject" id="email-subject" value="힐스테이트 메디알레 전자 위임장 제출">
          <input type="hidden" name="_captcha" value="false" />
          <input type="hidden" name="signature_image" id="signature-image" />

          <h2 class="section-title">수신 (수임인)</h2>
          <div class="info-block">힐스테이트 메디알레 입주예정자협의회 &lt;hillstatemediale@gmail.com&gt; </div>

          <h2 class="section-title">계약자 정보 (위임인)</h2>

          <div class="info-row">
            <div class="field-group">
              <label>계약자 성명 (필수)*</label>
              <input type="text" name="full_name" required />
              <div class="hint">반드시 계약자 명의로 기입해 주세요.</div>
            </div>

            <div class="field-group">
              <label>계약 동·호수 (필수)*</label>
              <div class="field-inline">
                <div class="field-group">
                  <label style="font-size:12px;">동</label>
                  <input type="text" name="dong" placeholder="예:123"
                         oninput="this.value=this.value.replace(/[^0-9]/g,'');" required />
                </div>
                <div class="field-group">
                  <label style="font-size:12px;">호</label>
                  <input type="text" name="ho" placeholder="예:456"
                         oninput="this.value=this.value.replace(/[^0-9]/g,'');" required />
                </div>
              </div>
            </div>
          </div>

          <div class="info-row">
            <div class="field-group">
              <label>생년월일 (필수)*</label>
              <input type="text" name="birth" maxlength="6" placeholder="예: 751225"
                     oninput="this.value=this.value.replace(/[^0-9]/g,'');" required />
              <div class="hint">주민등록번호 앞 6자리(숫자만)</div>
            </div>

            <div class="field-group">
              <label>휴대전화 번호 (필수)*</label>
              <input type="tel" name="phone" placeholder="예: 010-0000-0000" required />
            </div>
          </div>

          <div class="info-row">
            <div class="field-group">
              <label>이메일 (필수)*</label>
              <input type="email" name="email" placeholder="example@email.com" required />
            </div>

            <div class="field-group">
              <label>입주자 카페 ID (선택)</label>
              <input type="text" name="cafe_id" placeholder="네이버 카페 닉네임" />
            </div>
          </div>

          <div class="field-group">
            <label>공동명의 계약자 (있는 경우만) (선택)</label>
            <input type="text" name="co_full_name" placeholder="공동명의자 성명" />
          </div>

          <div class="section-card">
            <h3>위임 사항 안내</h3>

            <p class="delegate-intro">
              상기 계약자 본인(이하 “위임인”)은 서울특별시 은평구 대조동 88번지 일원에 건설되는 
              힐스테이트 메디알레 아파트의 입주예정자로서, 
              입주예정자협의회(입주예정자협의회 구성을 위한 TF단의 대표자 및 위원 일동을 포함하며, 이하 “수임인”이라고 한다)에게
              아래 명시된 위임사항을 안내받았으며, 이에 관련된 모든 제반업무를 수임인에게 전적으로 위임할 것을 확약합니다.
            </p>

            <h3>위임 사항</h3>
            <ol>
              <li>입주예정자의 권리·이익에 대한 업무추진 방향 설정</li>
              <li>입주예정자협의회 회원관리(가입, 징계, 탈퇴 등)</li>
              <li>협의회 회비의 집행 및 관리(징수, 모금, 내역증빙 등)</li>
              <li>시행자(조합 등) 및 시공자, 관련 용역사들과의 협의 및 협상</li>
              <li>대외홍보 및 각종 자문(각종 문자발송, 전화, 우편발송, SNS 운영 등)</li>
              <li>입주에 필요한 용역사(금융기관, 법무법인 등)의 입찰 및 선정에 대한 제반업무</li>
              <li>입주민의 이익을 위한 생활용품, 가전 등의 공동구매 추진</li>
              <li>아파트 품질·상품성 개선 관련 의견 제시 및 단지 내·외부 공사 및 시공 관련 사항</li>
              <li>진입로·보행로, 교통, 학교 등 주거환경 개선에 관한 사항과 관련된 제반업무</li>
              <li>하자보수와 관련 사항(하자 접수·취합·시행자 전달·협의 등)</li>
              <li>이 외 입주예정자들의 권익을 위한 각종 협의·동의·계약체결 등의 제반업무 및 의결</li>
              <li>이 외 상기 사항에 부대하여 수행되는 일체의 사항 및 업무(각종 외부자문 진행 등)</li>
            </ol>

            <h3>위임 효력 기간 및 철회</h3>
            <div class="delegate-intro">
              <strong>
                ※ 본 위임은 공동주택관리법 제11조에 따른 입주자대표회의 구성 및 권한 인수·인계 완료 시점까지 유효합니다.
              </strong><br>
              <strong>
                ※ 위임인은 서면 또는 전자문서로 통지하여 언제든지 위임을 철회할 수 있습니다.
              </strong><br>
              <strong>
                ※ 철회 이전에 수임인이 적법하게 수행한 행위의 효력에는 영향을 미치지 않습니다.
              </strong><br>
              <strong>
                ※ 공동명의자의 경우 아래의 서명인을 대표자로 선임하여 위임을 행하는 것에 동의합니다.
              </strong><br>
              <h3>위임 효력 발생 조건</h3>
              <strong>
                ※ 일반분양자 483세대 중 과반수 이상의 위임 동의가 완료된 시점부터,
                수임인은 입주예정자를 대표하여 위 위임 사항을 수행할 수 있습니다
              </strong><br>
              <h3>개인정보 처리 보호 서약 안내</h3>
              <strong>
                ※ 수임인은 본 위임장을 통해 수집한 개인정보를
                「개인정보 보호법」 및 관련 법령에 따라 안전하게 관리하며,
                어떠한 사적 용도 또는 부당한 외부 제공을 하지 않을 것을 엄중히 서약합니다.
              </strong><br>
            </div>
          </div>

          <div class="signature-wrapper">
            <h3 class="tab-label">서명 패드 (필수)*</h3>

            <div class="signature-box">
              <canvas id="signature-canvas"></canvas>

              <div class="signature-hint">마우스 또는 손가락으로 위 영역에 서명해 주세요.</div>

              <div class="signature-controls">
                <button type="button" id="clear-signature" class="btn-ghost">서명패드 지우기</button>
              </div>
            </div>

            <div id="signature-error" class="error-message">서명을 남겨주세요.</div>
          </div>

          <div class="consent-section">
            <div class="consent-title">개인정보 수집·이용 동의<span class="required">*</span></div>

            <div class="consent-text">
              <strong>1. 수집·이용 목적</strong><br />
              - 입주예정자협의회 운영 및 상기 위임사항 수행을 위한 정보 이용 및 안내<br /><br />

              <strong>2. 수집 항목</strong><br />
              - (필수) 성명, 생년월일(앞 6자리), 계약 동·호수, 휴대전화 번호, 이메일<br/>
              - (선택) 입주자 카페 ID, 공동명의자 성명<br /><br />

              <strong>3. 보유·이용 기간</strong><br />
              - 위임장 제출일로부터 공동주택관리법 제 11조에 따른 입주자대표회의 구성 시까지 보관 후 파기<br /><br />

              <strong>4. 동의 거부 권리 및 불이익</strong><br />
              - 개인정보 수집·이용 동의는 필수이며, 
              거부할 경우 입주예정자협의회 업무 사항 등에 대한 안내 및 통지가 누락될 수 있으며 이에 대한 불이익은 본인에게 귀속됩니다.
            </div>

            <div class="consent-checks">
              <label class="checkbox-row">
                <input type="checkbox" id="consent-privacy" />
                <span>「개인정보 보호법」제22조에 따라 상기 개인정보 수집·이용에 대하여 동의합니다.</span>
              </label>

              <label class="checkbox-row">
                <input type="checkbox" id="consent-delegation" />
                <span>위임 내용에 동의하며, 본 위임장을 전자서명으로 제출합니다.</span>
              </label>
            </div>
          </div>

          <div class="submit-area">
            <p>아래 버튼을 눌러 위임장을 제출해 주세요.</p>
            <button type="submit" class="btn-submit">위임장 제출</button>
            <div id="form-error" class="error-message"></div>

            <div class="download-area">
              전자적 제출보다 수기 작성이 편하신 경우, 아래 버튼을 통해 위임장을 다운로드 받으시고 메일주소로 보내주시기 바랍니다.
              <br>
              <a class="download-link" href="Power_of_Attorney.pdf" target="_blank" rel="noopener">서면 위임장 다운로드</a>
            </div>
          </div>

        </form>
      </main>
    </div>
  </div>

  <script>
  (function () {
    "use strict";

    const form   = document.getElementById("delegation-form");
    const canvas = document.getElementById("signature-canvas");

    if (!form || !canvas) {
      const msg = document.createElement("div");
      msg.style.cssText = "margin:12px;padding:10px;border:2px solid #c0392b;border-radius:10px;background:#fff0f0;color:#c0392b;font-weight:600;";
      msg.textContent = "요소를 찾지 못했습니다. id 확인 필요: delegation-form / signature-canvas";
      document.body.insertBefore(msg, document.body.firstChild);
      return;
    }

    const ctx = canvas.getContext("2d", { willReadFrequently: true });

    const signatureImageInput = document.getElementById("signature-image");
    const clearBtn            = document.getElementById("clear-signature");
    const signatureError      = document.getElementById("signature-error");
    const formError           = document.getElementById("form-error");

    const consentPrivacy      = document.getElementById("consent-privacy");
    const consentDelegation   = document.getElementById("consent-delegation");

    const emailSubjectInput   = document.getElementById("email-subject");

    let isDrawing = false;
    let lastX = 0, lastY = 0;
    let hasSignature = false;

    let snapshotDataURL = "";

    function setCanvasSizePreserve() {
      if (hasSignature) {
        try { snapshotDataURL = canvas.toDataURL("image/png"); } catch (e) {}
      }

      const rect = canvas.getBoundingClientRect();
      const cssW = Math.max(1, rect.width);
      const cssH = 220;
      const ratio = window.devicePixelRatio || 1;

      canvas.width  = Math.floor(cssW * ratio);
      canvas.height = Math.floor(cssH * ratio);

      ctx.setTransform(ratio, 0, 0, ratio, 0, 0);

      if (hasSignature && snapshotDataURL) {
        const img = new Image();
        img.onload = () => {
          ctx.clearRect(0, 0, cssW, cssH);
          ctx.drawImage(img, 0, 0, cssW, cssH);
        };
        img.src = snapshotDataURL;
      } else {
        ctx.clearRect(0, 0, cssW, cssH);
      }
    }

    setCanvasSizePreserve();

    window.addEventListener("resize", () => {
      window.requestAnimationFrame(setCanvasSizePreserve);
    });

    if (window.ResizeObserver) {
      const ro = new ResizeObserver(() => {
        window.requestAnimationFrame(setCanvasSizePreserve);
      });
      ro.observe(canvas);
    }

    function getPointFromEvent(e) {
      const rect = canvas.getBoundingClientRect();
      if (e.touches && e.touches[0]) {
        return {
          x: e.touches[0].clientX - rect.left,
          y: e.touches[0].clientY - rect.top
        };
      }
      return {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
      };
    }

    function start(e) {
      if (e.cancelable) e.preventDefault();
      const p = getPointFromEvent(e);
      isDrawing = true;
      hasSignature = true;
      lastX = p.x;
      lastY = p.y;
      if (signatureError) signatureError.style.display = "none";
    }

    function move(e) {
      if (!isDrawing) return;
      if (e.cancelable) e.preventDefault();

      const p = getPointFromEvent(e);

      ctx.strokeStyle = "#000";
      ctx.lineWidth = 2;
      ctx.lineCap = "round";
      ctx.lineJoin = "round";

      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();

      lastX = p.x;
      lastY = p.y;

      try { snapshotDataURL = canvas.toDataURL("image/png"); } catch (e2) {}
    }

    function end(e) {
      if (e && e.cancelable) e.preventDefault();
      isDrawing = false;
    }

    canvas.addEventListener("mousedown", start);
    canvas.addEventListener("mousemove", move);
    canvas.addEventListener("mouseup", end);
    canvas.addEventListener("mouseleave", end);

    canvas.addEventListener("touchstart", start, { passive: false });
    canvas.addEventListener("touchmove", move, { passive: false });
    canvas.addEventListener("touchend", end, { passive: false });
    canvas.addEventListener("touchcancel", end, { passive: false });

    if (clearBtn) {
      clearBtn.addEventListener("click", () => {
        const rect = canvas.getBoundingClientRect();
        // 캔버스 크기가 변경될 수 있으므로, 실제 canvas.width/height 대신 css 크기를 사용
        ctx.clearRect(0, 0, rect.width, 220); 
        hasSignature = false;
        snapshotDataURL = "";
        if (signatureError) signatureError.style.display = "none";
      });
    }

    function preserveOnUIChange() {
      if (!hasSignature) return;
      try { snapshotDataURL = canvas.toDataURL("image/png"); } catch (e) {}
      requestAnimationFrame(() => {
        if (!hasSignature || !snapshotDataURL) return;
        const img = new Image();
        img.onload = () => {
          const rect = canvas.getBoundingClientRect();
          ctx.clearRect(0, 0, rect.width, 220);
          ctx.drawImage(img, 0, 0, rect.width, 220);
        };
        img.src = snapshotDataURL;
      });
    }

    if (consentPrivacy)    consentPrivacy.addEventListener("change", preserveOnUIChange);
    if (consentDelegation) consentDelegation.addEventListener("change", preserveOnUIChange);

    function exportSignatureCompressed() {
      const rect = canvas.getBoundingClientRect();
      const srcW = Math.floor(rect.width);
      const srcH = 220;

      const maxW = 400;
      const outW = Math.min(srcW, maxW);
      const outH = Math.floor(outW * (srcH / srcW));

      const out = document.createElement("canvas");
      out.width = outW;
      out.height = outH;
      const octx = out.getContext("2d");

      octx.fillStyle = "#ffffff";
      octx.fillRect(0, 0, outW, outH);

      octx.drawImage(canvas, 0, 0, outW, outH);

      return out.toDataURL("image/jpeg", 0.65);
    }

    form.addEventListener("submit", function (e) {
      if (formError) {
        formError.textContent = "";
        formError.style.display = "none";
      }
      if (signatureError) signatureError.style.display = "none";

      if (emailSubjectInput) {
        const name = (document.querySelector('input[name="full_name"]')?.value || "").trim();
        const dong = (document.querySelector('input[name="dong"]')?.value || "").trim();
        const ho   = (document.querySelector('input[name="ho"]')?.value || "").trim();
        emailSubjectInput.value = `힐스테이트 메디알레 전자 위임장 제출 - ${name} (${dong}동 ${ho}호)`;
      }

      if (!consentPrivacy?.checked || !consentDelegation?.checked) {
        e.preventDefault();
        if (formError) {
          formError.textContent = "모든 동의사항에 체크해 주세요.";
          formError.style.display = "block";
        } else {
          alert("모든 동의사항에 체크해 주세요.");
        }
        return;
      }

      if (!hasSignature) {
        e.preventDefault();
        if (signatureError) {
          signatureError.style.display = "block";
        } else {
          alert("서명을 남겨주세요.");
        }
        return;
      }

      if (signatureImageInput) {
        signatureImageInput.value = exportSignatureCompressed();
      }
    });
  })();
  </script>
</body>
</html>
